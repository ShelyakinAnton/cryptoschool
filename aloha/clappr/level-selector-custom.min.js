!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],t):"object"==typeof exports?exports.LevelSelector=t(require("Clappr")):e.LevelSelector=t(e.Clappr)}("undefined"!=typeof self?self:this,function(e){return function(e){function t(n){if(l[n])return l[n].exports;var i=l[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var l={};return t.m=e,t.c=l,t.d=function(e,l,n){t.o(e,l)||Object.defineProperty(e,l,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var l=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(l,"a",l),l},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=l(1),e.exports=t.default},function(e,t,l){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var l=0;l<t.length;l++){var n=t[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,l,n){return l&&e(t.prototype,l),n&&e(t,n),t}}(),a=l(2),u=l(3),c=n(u),v=l(4),h=n(v),f=function(e){function t(e){i(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));l.seekTime=0;var n=l.core.options.levelSelectorConfig||{};if(l.labelCallback=n.labelCallback,l.labelCallback&&"function"!=typeof l.labelCallback)throw new TypeError("labelCallback must be a function");return l.initialLevel=n.initialLevel?n.initialLevel:0,l.labels=n.labels||{},l.title=n.title,l.auto=n.auto,void 0===l.auto&&(l.auto=!0),l}return r(t,e),s(t,[{key:"name",get:function(){return"level_selector"}},{key:"template",get:function(){return(0,a.template)(c.default)}},{key:"attributes",get:function(){return{class:this.name,"data-level-selector":""}}},{key:"events",get:function(){return{"click [data-level-selector-select]":"onLevelSelect","click [data-level-selector-button]":"onShowLevelSelectMenu"}}}],[{key:"version",get:function(){return VERSION}}]),s(t,[{key:"bindEvents",value:function(){this.listenTo(this.core,a.Events.CORE_READY,this.bindPlaybackEvents),this.listenTo(this.core.mediaControl,a.Events.MEDIACONTROL_CONTAINERCHANGED,this.reload),this.listenTo(this.core.mediaControl,a.Events.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.core.mediaControl,a.Events.MEDIACONTROL_HIDE,this.hideSelectLevelMenu)}},{key:"unBindEvents",value:function(){this.stopListening(this.core,a.Events.CORE_READY),this.stopListening(this.core.mediaControl,a.Events.MEDIACONTROL_CONTAINERCHANGED),this.stopListening(this.core.mediaControl,a.Events.MEDIACONTROL_RENDERED),this.stopListening(this.core.mediaControl,a.Events.MEDIACONTROL_HIDE);var e=this.core.getCurrentPlayback();this.stopListening(e,a.Events.PLAYBACK_LEVELS_AVAILABLE),this.stopListening(e,a.Events.PLAYBACK_LEVEL_SWITCH_START),this.stopListening(e,a.Events.PLAYBACK_LEVEL_SWITCH_END),this.auto?this.stopListening(e,a.Events.PLAYBACK_BITRATE):this.stopListening(e,a.Events.PLAYBACK_PLAY)}},{key:"bindPlaybackEvents",value:function(){var e=this.core.getCurrentPlayback();this.listenTo(e,a.Events.PLAYBACK_LEVELS_AVAILABLE,this.fillLevels),this.listenTo(e,a.Events.PLAYBACK_LEVEL_SWITCH_START,this.startLevelSwitch),this.listenTo(e,a.Events.PLAYBACK_LEVEL_SWITCH_END,this.stopLevelSwitch),this.auto?this.listenTo(e,a.Events.PLAYBACK_BITRATE,this.updateCurrentLevel):this.listenTo(e,a.Events.PLAYBACK_PLAY,this.seek),e.levels&&e.levels.length>0&&this.fillLevels(e.levels)}},{key:"seek",value:function(){if(this.seekTime){this.core.getCurrentPlayback().seek(this.seekTime),this.seekTime=0}}},{key:"resetState",value:function(){this.$el.hide(),this.currentLevel=void 0,this.selectedLevelId=void 0,this.levels=[]}},{key:"reload",value:function(){this.resetState(),this.unBindEvents(),this.bindEvents(),this.bindPlaybackEvents()}},{key:"shouldRender",value:function(){if(!this.core.getCurrentContainer())return!1;var e=this.core.getCurrentPlayback();if(!e)return!1;var t=void 0!==e.currentLevel,l=!!(this.levels&&this.levels.length>1);return t&&l}},{key:"render",value:function(){if(this.shouldRender()){var e=a.Styler.getStyleFor(h.default,{baseUrl:this.core.options.baseUrl});this.$el.html(this.template({levels:this.levels,title:this.title,hasAuto:this.auto})),this.$el.append(e),this.core.mediaControl.$(".media-control-right-panel").append(this.el),this.highlightCurrentLevel(),this.$el.show()}return this}},{key:"fillLevels",value:function(e){var t=e.length-1;this.initialLevel>t?this.initialLevel=t:this.initialLevel<0&&(this.initialLevel=0),this.auto&&(this.initialLevel=-1),void 0===this.selectedLevelId&&(this.selectedLevelId=this.initialLevel),this.levels=e;var l=this.core.getCurrentPlayback().currentLevel;this.auto||this.selectedLevelId===l||this.setCurrentLevel(this.selectedLevelId),this.configureLevelsLabels(),this.render()}},{key:"setCurrentLevel",value:function(e){if(this.core.getCurrentPlayback().currentLevel=e,!this.auto){var t=this.findLevelBy(e);this.currentLevel=t||null,this.highlightCurrentLevel()}var l=this.core.getCurrentPlayback();this.auto||"hls"!==l.name||(l.isSeekEnabled()&&(this.seekTime=l.getCurrentTime()),l._hls.recoverMediaError())}},{key:"updateCurrentLevel",value:function(e){var t=this.findLevelBy(e.level);this.currentLevel=t||null,this.highlightCurrentLevel()}},{key:"configureLevelsLabels",value:function(){if(this.labelCallback||this.labels)for(var e in this.levels){var t=this.levels[e],l=this.labels[t.id];this.labelCallback?t.label=this.labelCallback(t,l):l&&(t.label=l)}}},{key:"findLevelBy",value:function(e){var t=void 0;return this.levels.forEach(function(l){l.id===e&&(t=l)}),t}},{key:"onLevelSelect",value:function(e){return this.selectedLevelId=parseInt(e.target.dataset.levelSelectorSelect,10),this.core.getCurrentPlayback().currentLevel!==this.selectedLevelId&&this.currentLevel.id!==this.selectedLevelId&&(this.setCurrentLevel(this.selectedLevelId),this.toggleContextMenu(),e.stopPropagation(),!1)}},{key:"onShowLevelSelectMenu",value:function(){this.toggleContextMenu()}},{key:"hideSelectLevelMenu",value:function(){this.$(".level_selector ul").hide()}},{key:"toggleContextMenu",value:function(){this.$(".level_selector ul").toggle()}},{key:"buttonElement",value:function(){return this.$(".level_selector button")}},{key:"levelElement",value:function(e){return this.$(".level_selector ul a"+(isNaN(e)?"":'[data-level-selector-select="'+e+'"]')).parent()}},{key:"startLevelSwitch",value:function(){this.buttonElement().addClass("changing")}},{key:"stopLevelSwitch",value:function(){this.buttonElement().removeClass("changing")}},{key:"updateText",value:function(e){if(-1===e)this.buttonElement().text(this.currentLevel?"AUTO ("+this.currentLevel.label+")":"AUTO");else{var t=this.findLevelBy(e).label;this.buttonElement().text(t)}}},{key:"highlightCurrentLevel",value:function(){this.levelElement().removeClass("current"),this.currentLevel&&this.levelElement(this.currentLevel.id).addClass("current"),this.updateText(this.selectedLevelId)}}]),t}(a.UICorePlugin);t.default=f,e.exports=t.default},function(t,l){t.exports=e},function(e,t){e.exports='<button data-level-selector-button> Auto </button> <ul> <% if (title) { %> <li data-title><%= title %></li> <% }; %> <% if (hasAuto) { %> <li><a href=# data-level-selector-select=-1>AUTO</a></li> <% }; %> <% for (var i = levels.length - 1; i >= 0; i--) { %> <li><a href=# data-level-selector-select="<%= levels[i].id %>"><%= levels[i].label %></a></li> <% }; %> </ul> '},function(e,t,l){t=e.exports=l(5)(!1),t.push([e.i,'no-outline, .level_selector[data-level-selector] button, .level_selector[data-level-selector] li a {\n  outline: none; }\n\n.level_selector[data-level-selector] {\n  float: right;\n  margin-top: 8px;\n  position: relative; }\n  .level_selector[data-level-selector] button {\n    background-color: transparent;\n    color: #fff;\n    font-family: Roboto, "Open Sans", Arial,sans-serif;\n    -webkit-font-smoothing: antialiased;\n    border: none;\n    font-size: 10px; }\n    .level_selector[data-level-selector] button:hover {\n      color: #c9c9c9; }\n    .level_selector[data-level-selector] button.changing {\n      animation: pulse 0.5s infinite alternate; }\n  .level_selector[data-level-selector] > ul {\n    list-style-type: none;\n    position: absolute;\n    bottom: 25px;\n    border: 1px solid black;\n    display: none;\n    background-color: #e6e6e6; }\n  .level_selector[data-level-selector] li {\n    font-size: 10px; }\n    .level_selector[data-level-selector] li[data-title] {\n      background-color: #c3c2c2;\n      padding: 5px; }\n    .level_selector[data-level-selector] li a {\n      color: #444;\n      padding: 2px 10px;\n      display: block;\n      text-decoration: none; }\n      .level_selector[data-level-selector] li a:hover {\n        background-color: #555;\n        color: white; }\n        .level_selector[data-level-selector] li a:hover a {\n          color: white;\n          text-decoration: none; }\n    .level_selector[data-level-selector] li.current a {\n      color: #f00; }\n\n@keyframes pulse {\n  0% {\n    color: #fff; }\n  50% {\n    color: #ff0101; }\n  100% {\n    color: #B80000; } }\n',""])},function(e,t){function l(e,t){var l=e[1]||"",i=e[3];if(!i)return l;if(t&&"function"==typeof btoa){var o=n(i);return[l].concat(i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"})).concat([o]).join("\n")}return[l].join("\n")}function n(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=l(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,l){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<e.length;i++){var r=e[i];"number"==typeof r[0]&&n[r[0]]||(l&&!r[2]?r[2]=l:l&&(r[2]="("+r[2]+") and ("+l+")"),t.push(r))}},t}}])});
//# sourceMappingURL=level-selector.min.js.map